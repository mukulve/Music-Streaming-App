/*! Fast Average Color | Â© 2022 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */function O(t){var r=t.toString(16);return r.length===1?"0"+r:r}function E(t){return"#"+t.map(O).join("")}function P(t){var r=(t[0]*299+t[1]*587+t[2]*114)/1e3;return r<128}function S(t){return t?D(t)?t:[t]:[]}function D(t){return Array.isArray(t[0])}function p(t,r,e){for(var a=0;a<e.length;a++)if(B(t,r,e[a]))return!0;return!1}function B(t,r,e){switch(e.length){case 3:if(q(t,r,e))return!0;break;case 4:if(F(t,r,e))return!0;break;case 5:if(_(t,r,e))return!0;break;default:return!1}}function q(t,r,e){return t[r+3]!==255||t[r]===e[0]&&t[r+1]===e[1]&&t[r+2]===e[2]}function F(t,r,e){return t[r+3]&&e[3]?t[r]===e[0]&&t[r+1]===e[1]&&t[r+2]===e[2]&&t[r+3]===e[3]:t[r+3]===e[3]}function M(t,r,e){return t>=r-e&&t<=r+e}function _(t,r,e){var a=e[0],i=e[1],n=e[2],s=e[3],o=e[4],f=t[r+3],h=M(f,s,o);return s?!!(!f&&h||M(t[r],a,o)&&M(t[r+1],i,o)&&M(t[r+2],n,o)&&h):h}function x(t,r,e){for(var a={},i=24,n=e.ignoredColor,s=e.step,o=[0,0,0,0,0],f=0;f<r;f+=s){var h=t[f],u=t[f+1],l=t[f+2],c=t[f+3];if(!(n&&p(t,f,n))){var v=Math.round(h/i)+","+Math.round(u/i)+","+Math.round(l/i);a[v]?a[v]=[a[v][0]+h*c,a[v][1]+u*c,a[v][2]+l*c,a[v][3]+c,a[v][4]+1]:a[v]=[h*c,u*c,l*c,c,1],o[4]<a[v][4]&&(o=a[v])}}var d=o[0],A=o[1],R=o[2],g=o[3],y=o[4];return g?[Math.round(d/g),Math.round(A/g),Math.round(R/g),Math.round(g/y)]:e.defaultColor}function z(t,r,e){for(var a=0,i=0,n=0,s=0,o=0,f=e.ignoredColor,h=e.step,u=0;u<r;u+=h){var l=t[u+3],c=t[u]*l,v=t[u+1]*l,d=t[u+2]*l;f&&p(t,u,f)||(a+=c,i+=v,n+=d,s+=l,o++)}return s?[Math.round(a/s),Math.round(i/s),Math.round(n/s),Math.round(s/o)]:e.defaultColor}function j(t,r,e){for(var a=0,i=0,n=0,s=0,o=0,f=e.ignoredColor,h=e.step,u=0;u<r;u+=h){var l=t[u],c=t[u+1],v=t[u+2],d=t[u+3];f&&p(t,u,f)||(a+=l*l*d,i+=c*c*d,n+=v*v*d,s+=d,o++)}return s?[Math.round(Math.sqrt(a/s)),Math.round(Math.sqrt(i/s)),Math.round(Math.sqrt(n/s)),Math.round(s/o)]:e.defaultColor}function H(t){return I(t,"defaultColor",[0,0,0,0])}function I(t,r,e){return t[r]===void 0?e:t[r]}var T=10,b=100;function G(t){return t.search(/\.svg(\?|$)/i)!==-1}function k(t){if(w(t)){var r=t.naturalWidth,e=t.naturalHeight;return!t.naturalWidth&&G(t.src)&&(r=e=b),{width:r,height:e}}return N(t)?{width:t.videoWidth,height:t.videoHeight}:{width:t.width,height:t.height}}function L(t){return X(t)?"canvas":V(t)?"offscreencanvas":Z(t)?"imagebitmap":t.src}function w(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement}function V(t){return typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}function N(t){return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement}function X(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}function Z(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap}function $(t,r){var e=I(r,"left",0),a=I(r,"top",0),i=I(r,"width",t.width),n=I(r,"height",t.height),s=i,o=n;if(r.mode==="precision")return{srcLeft:e,srcTop:a,srcWidth:i,srcHeight:n,destWidth:s,destHeight:o};var f;return i>n?(f=i/n,s=b,o=Math.round(s/f)):(f=n/i,o=b,s=Math.round(o/f)),(s>i||o>n||s<T||o<T)&&(s=i,o=n),{srcLeft:e,srcTop:a,srcWidth:i,srcHeight:n,destWidth:s,destHeight:o}}var J=typeof window>"u";function K(){return J?new OffscreenCanvas(1,1):document.createElement("canvas")}var W="FastAverageColor: ";function C(t,r,e){r||(console.error(W+t),e&&console.error(e))}function m(t){return Error(W+t)}var Q=function(){function t(){this.canvas=null,this.ctx=null}return t.prototype.getColorAsync=function(r,e){if(!r)return Promise.reject(m("call .getColorAsync() without resource."));if(typeof r=="string"){if(typeof Image>"u")return Promise.reject(m("resource as string is not supported in this environment"));var a=new Image;return a.crossOrigin=e&&e.crossOrigin||"",a.src=r,this.bindImageEvents(a,e)}else{if(w(r)&&!r.complete)return this.bindImageEvents(r,e);var i=this.getColor(r,e);return i.error?Promise.reject(i.error):Promise.resolve(i)}},t.prototype.getColor=function(r,e){e=e||{};var a=H(e);if(!r)return C("call .getColor(null) without resource",e.silent),this.prepareResult(a);var i=k(r),n=$(i,e);if(!n.srcWidth||!n.srcHeight||!n.destWidth||!n.destHeight)return C('incorrect sizes for resource "'.concat(L(r),'"'),e.silent),this.prepareResult(a);if(this.canvas||(this.canvas=K()),!this.ctx&&(this.ctx=this.canvas.getContext&&this.canvas.getContext("2d"),!this.ctx))return C("Canvas Context 2D is not supported in this browser",e.silent),this.prepareResult(a);this.canvas.width=n.destWidth,this.canvas.height=n.destHeight;var s=a;try{this.ctx.clearRect(0,0,n.destWidth,n.destHeight),this.ctx.drawImage(r,n.srcLeft,n.srcTop,n.srcWidth,n.srcHeight,0,0,n.destWidth,n.destHeight);var o=this.ctx.getImageData(0,0,n.destWidth,n.destHeight).data;s=this.getColorFromArray4(o,e)}catch(f){C("security error (CORS) for resource ".concat(L(r),`.
Details: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image`),e.silent,f)}return this.prepareResult(s)},t.prototype.getColorFromArray4=function(r,e){e=e||{};var a=4,i=r.length,n=H(e);if(i<a)return n;var s=i-i%a,o=(e.step||1)*a,f;switch(e.algorithm||"sqrt"){case"simple":f=z;break;case"sqrt":f=j;break;case"dominant":f=x;break;default:throw m("".concat(e.algorithm," is unknown algorithm"))}return f(r,s,{defaultColor:n,ignoredColor:S(e.ignoredColor),step:o})},t.prototype.prepareResult=function(r){var e=r.slice(0,3),a=[r[0],r[1],r[2],r[3]/255],i=P(r);return{value:[r[0],r[1],r[2],r[3]],rgb:"rgb("+e.join(",")+")",rgba:"rgba("+a.join(",")+")",hex:E(e),hexa:E(r),isDark:i,isLight:!i}},t.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},t.prototype.bindImageEvents=function(r,e){var a=this;return new Promise(function(i,n){var s=function(){h();var u=a.getColor(r,e);u.error?n(u.error):i(u)},o=function(){h(),n(m('Error loading image "'.concat(r.src,'".')))},f=function(){h(),n(m('Image "'.concat(r.src,'" loading aborted')))},h=function(){r.removeEventListener("load",s),r.removeEventListener("error",o),r.removeEventListener("abort",f)};r.addEventListener("load",s),r.addEventListener("error",o),r.addEventListener("abort",f)})},t}();export{Q as FastAverageColor};
